<?php include COMMON_PATH.'/header.html';?>
<div class="layui-container fly-marginTop fly-user-main">
    <?php include COMMON_PATH.'/member-nav.html';?>
    <div class="fly-panel fly-panel-user" pad20>
        <div class="layui-tab layui-tab-brief" lay-filter="api">
            <ul class="layui-tab-title" id="LAY_mine">
                <li class="layui-this" lay-id="api">API配置</li>
                <li lay-id="api_info"><a href="/member/api/doc/">API说明</a></li>
            </ul>
            <div class="layui-tab-content" style="padding: 20px 0;">
                <div class="layui-form layui-form-pane layui-tab-item layui-show">
                    <div class="layui-form-item layui-show">
                        <?php if(is_array($api) AND !empty($api)):?>
                        <div class="layui-elem-quote">
                            <p>您已经成功申请API，您还需要配置安全IP，才可以正常使用</p>
                        </div>
                        <?php else:?>
                        <div class="layui-elem-quote">
                            <p>申请API，您可以自主管理</p>
                        </div>
                        <button class="layui-btn" lay-filter="api" lay-submit>申请开通</button>
                        <?php endif;?>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!--引入公共底文件-->
<?php include COMMON_PATH.'/footer.html';?>
<script>
	layui.use(['form', 'layer'], function(){
		var $ = layui.$;
		var form = layui.form;
		var layer = layui.layer;
		form.on('submit(api)', function(data){

			data.field.method = 'on';
			data.field.csrf_token = TOKEN;
			var i = layer.load(2,{shade: [0.5,'#fff']});
			$.ajax({
				url: '/member/api/ajax',
				type: 'post',
				dataType: 'json',
				data: data.field,
			})
			.done(function(res) {
				if (res.code == '1') {
					layer.open({
					title: '提示',
					icon: 1,
					content: res.msg,
					btn: ['确定'],
					yes: function(index, layero){
					    location.reload;
					},
					cancel: function(){
					    location.reload;
					}
				});
				} else {
					layer.msg(res.msg,{icon:2,time:5000});
				}
			})
			.fail(function() {
				layer.msg('服务器连接失败，请联系管理员',{icon:2,time:5000});
			})
			.always(function() {
				layer.close(i);
			});

			return false; //阻止表单跳转。
		});
	})
</script>